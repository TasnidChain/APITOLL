name = "apitoll"
main = "src/index.ts"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

# Cloudflare Workers Configuration
type = "javascript"
account_id = "YOUR_CLOUDFLARE_ACCOUNT_ID"
workers_dev = false

# Environment-specific configs
[env.production]
name = "apitoll-production"
routes = [
  { pattern = "apitoll.com", zone_name = "apitoll.com" },
  { pattern = "*.apitoll.com", zone_name = "apitoll.com" }
]
vars = { ENVIRONMENT = "production" }

[env.staging]
name = "apitoll-staging"
routes = [
  { pattern = "staging.apitoll.com", zone_name = "apitoll.com" }
]
vars = { ENVIRONMENT = "staging" }

# KV Namespaces (for caching, sessions, rate limiting)
[[kv_namespaces]]
binding = "CACHE"
id = "YOUR_KV_NAMESPACE_ID"
preview_id = "YOUR_KV_PREVIEW_ID"

[[kv_namespaces]]
binding = "SESSIONS"
id = "YOUR_KV_SESSION_ID"
preview_id = "YOUR_KV_SESSION_PREVIEW_ID"

# D1 Database (for persistent storage)
[[d1_databases]]
binding = "DB"
database_name = "apitoll"
database_id = "YOUR_D1_DATABASE_ID"

# R2 Bucket (for file storage)
[[r2_buckets]]
binding = "BUCKET"
bucket_name = "apitoll-files"
preview_bucket_name = "apitoll-files-preview"

# Environment variables
[env.production.vars]
STRIPE_SECRET_KEY = "sk_live_..."
STRIPE_WEBHOOK_SECRET = "whsec_..."
EXECUTOR_PRIVATE_KEY = "0x..."
BASE_RPC_URL = "https://mainnet.base.org"
ALLOWED_ORIGINS = "https://apitoll.com,https://app.apitoll.com"
LOG_LEVEL = "info"

[env.staging.vars]
STRIPE_SECRET_KEY = "sk_test_..."
STRIPE_WEBHOOK_SECRET = "whsec_test_..."
EXECUTOR_PRIVATE_KEY = "0x..."
BASE_RPC_URL = "https://sepolia.base.org"
ALLOWED_ORIGINS = "https://staging.apitoll.com,http://localhost:3000"
LOG_LEVEL = "debug"

# Build configuration
[build]
command = "npm run build"
cwd = "./"
watch_paths = ["src/**/*.ts"]

# Observability
[observability]
enabled = true
